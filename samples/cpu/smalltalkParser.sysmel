## Main function
Compiler importModulesNamed: #(
    "Smalltalk.Runtime.Core"
).

Std MainEntryPoint: {:args :: Int32 |
    1 until: args size do: {:i :: Void |
        Std stdout << "Expression: " << args[i] asSmalltalkString; nl.

        try:
        {
            Std stdout << "First token "<< (Smalltalk RBScanner on: (Smalltalk ReadStream on: args[i] asSmalltalkString)) next; nl.
        } catch: Smalltalk Error doing: {:e :: Void |
            Std stdout << "Error during scanning: " << e; nl.
        }.

        try:
        {
            ##Std stdout << "AST "<< (Smalltalk RBParser parseExpression: args[i] asSmalltalkString); nl.
            Std stdout << "Literals "<< (Smalltalk RBParser parseLiterals: args[i] asSmalltalkString); nl.
        } catch: Smalltalk Error doing: {:e :: Void |
            Std stdout << "Error during parsing: " << e; nl.
        }.

        try:
        {
            Std stdout << "AST "<< (Smalltalk RBParser parseExpression: args[i] asSmalltalkString); nl.
        } catch: Smalltalk Error doing: {:e :: Void |
            Std stdout << "Error during parsing: " << e; nl.
        }.

        #*try:
        {
            Std stdout << "CompiledMethod "<< (Smalltalk OpalCompiler new noPattern: true; compile: args[i] asSmalltalkString); nl.
        } catch: Smalltalk Error doing: {:e :: Void |
            Std stdout << "Error during compilation: " << e; nl.
        }.*#

        let compiledMethod := Smalltalk OpalCompiler new noPattern: true; compile: args[i] asSmalltalkString.
        Std stdout << "CompiledMethod " << compiledMethod; nl.
        Std stdout << "CompiledMethod " << compiledMethod dumpString; nl.
    }.

    return: 0.
}.
